@{
    ViewBag.Title = "Melbourne";
}
<main>
    <section class="row" aria-labelledby="aspnetTitle">
        <h1 id="title">
            <img src="https://sydneynorthhealthnetwork.org.au/wp-content/uploads/2021/01/Sunsmart.png" alt="Sample Picture" style="float: left; margin-right: 10px;" width="120" height="120">
            UV is HARMFUL to your skin!
        </h1>
    </section>

    <div class="row">
        <div class="col-md-6">
            <div class="card" style="text-align: center; height: 200px; background-color: @ViewBag.Color">
                <div class="card-body">
                    <p>UV index</p>
                    <h2 id="uvindex" style="font-size: 100px; font-weight: bold;">@ViewBag.Message</h2>
                </div>
            </div>
            <div class="card" style="text-align: center; height: 200px">
                <div class="card-body">
                    <p>TIPS</p>
                    <h2 style="color:@ViewBag.Color">@ViewBag.Tips</h2>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card" style="text-align: center; height: 400px">
                <div class="card-body">
                    <img src="https://img.freepik.com/premium-vector/uv-index-level-sun-numbers-solar-protection-scale-sun-exposure-risk-low-extreme_352905-803.jpg?w=360" alt="UV chart static" style="max-width: 100%; height: auto;">
                </div>
            </div>
        </div>
    </div>

    <script>
        function getWeatherData() {
                latitude = -37.84;
                longitude = 144.94;
            // testurl: "https://api.openweathermap.org/data/3.0/onecall?lat=41.15&lon=16.85&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027" Bari
            // testurl: "https://api.openweathermap.org/data/3.0/onecall?lat=41.54&lon=12.29&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027" Roma
            // testurl: "https://api.openweathermap.org/data/3.0/onecall?lat=30.03&lon=31.14&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027" Cairo
            // testurl: "https://api.openweathermap.org/data/3.0/onecall?lat=-34.60333&lon=-58.38167&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027" Buenos Aires
            // Trueurl: "https://api.openweathermap.org/data/3.0/onecall?lat=" + latitude + "&lon=" + longitude + "&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027"
            var apiUrl = "https://api.openweathermap.org/data/3.0/onecall?lat=" + latitude + "&lon=" + longitude + "&exclude=hourly,daily&appid=d2dba7f53adbb152167188a597023027";

            // send Ajax Get Request
            var xhr = new XMLHttpRequest();
            xhr.open("GET", apiUrl, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Succeed
                    console.log("Data sent successfully!");
                    var responseData = JSON.parse(xhr.responseText);
                    // Do something with the response data
                    console.log(responseData.current.uvi);
                    var uvindex = responseData.current.uvi;

                    // Call sendLocationToBackend after obtaining uvindex
                    sendLocationToBackend(latitude, longitude, uvindex);
                }
            };
            xhr.send(); // Send the request
        }

        function sendLocationToBackend(latitude, longitude, uvindex) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/Home/GetUserLocation", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

            var data = JSON.stringify({
                latitude: latitude,
                longitude: longitude,
                uvindex: uvindex
            });
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        console.log("Location sent successfully");
                        setTimeout(function () {
                            window.location.href = '/Home/Index';
                        }, 1500);

                    } else {
                        console.error("Failed to send location");
                    }
                }
            };
            console.log(data);
            xhr.send(data);

    }
    </script>

</main>
